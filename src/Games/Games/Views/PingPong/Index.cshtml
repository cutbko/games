<div id="gameArea">
    <canvas id="gameCanvas" width="0" height="0" style="background-color: gray"></canvas>
</div>

<div id="player1Login" class ="playerLogin">
    <div id="player1LoginContent" class="playerLoginContent">
        <img src="@Url.Action("Player1JoinQr", new { gameId = ViewBag.GameId })" alt="assa" />
    </div>
</div>

<div id="player2Login" class="playerLogin">
    <div id="player2LoginContent" class="playerLoginContent">
        <img src="@Url.Action("Player2JoinQr", new { gameId = ViewBag.GameId })" alt="assa" />
    </div>
</div>

@section scripts
{
    <script src="~/Scripts/require.js" data-main="/Scripts/Modules/pingPongFactory.js"></script>
    <script>
        var serverSocketChannelUri = 'ws://@Request.Url.Host:@Request.Url.Port' + '@Url.HttpRouteUrl("DefaultApi", new { controller = "PingPongApi", gameId = ViewBag.GameId })';

        $(document).ready(function () { 

            require(['pingPongFactory'], function (pingPongFactory) {
                window.pingPongGame = pingPongFactory.create("gameCanvas");

                resizeGame();
                window.addEventListener('resize', resizeGame, false);
                window.addEventListener('orientationchange', resizeGame, false);
                
                var ws = new WebSocket(serverSocketChannelUri);
                ws.onopen = function () {
                    console.log('open');
                };

                ws.onmessage = function (event) {
                    console.log(event.data);
                };

                ws.onerror = function (event) {
                    console.log('error');
                    console.log(event);
                };

                //prompt('her', '@ViewBag.GameId');
            });
        });

        function hidePlayer1Login() {
            $("#player1Login").animate({ left: "-1000px" }, 1000, function () {
                $(this).css({ display: 'none' });
            });
        }

        function hidePlayer2Login() {
            $("#player2Login").animate({ left: "2000px" }, 1000, function () {
                $(this).css({ display: 'none' });
            });
        }

        function resizeGame() {
            var player1Login = document.getElementById('player1Login');
            var player2Login = document.getElementById('player2Login');

            var player1LoginContent = document.getElementById('player1LoginContent');
            var player2LoginContent = document.getElementById('player2LoginContent');

            var header = document.querySelector('header');
            var gameArea = document.getElementById('gameArea');
            var widthToHeight = 16 / 9;
            var newWidth = window.innerWidth;
            var newHeight = window.innerHeight - header.offsetHeight;
            var newWidthToHeight = newWidth / newHeight;

            if (newWidthToHeight > widthToHeight) {
                newWidth = newHeight * widthToHeight;
                gameArea.style.height = newHeight + 'px';
                gameArea.style.width = newWidth + 'px';
                gameArea.style.left = (window.innerWidth - newWidth) / 2 + "px";
            } else {
                newHeight = newWidth / widthToHeight;
                gameArea.style.width = newWidth + 'px';
                gameArea.style.height = newHeight + 'px';
                gameArea.style.left = "0px";
            }

            player1Login.style.height = player2Login.style.height = (window.innerHeight - header.offsetHeight) + 'px';
            player1Login.style.top = player2Login.style.top = header.offsetHeight + 'px';
            player1Login.style.width = player2Login.style.left = player2Login.style.width = window.innerWidth / 2 + 'px';
            
            gameArea.style.top = header.offsetHeight + 'px';

            var gameCanvas = document.getElementById('gameCanvas');
            gameCanvas.width = newWidth;
            gameCanvas.height = newHeight;
        }
    </script>
}
